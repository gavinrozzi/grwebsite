---
title: "New Jersey's official geocoding API now has a client for R"
author: "Gavin C. Rozzi"
date: "2022-02-04"
output:
  md_document:
    preserve_yaml: TRUE
    df_print: kable
    fig_retina: 2
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r message=FALSE, include=FALSE}
library(njgeo)
library(tidyverse)
```

I am often critical of the lack of, or inconsistent availability of administrative data from public authorities in New Jersey. But one bright spot I recently discovered has been the [free geocoding service](https://njgin.nj.gov/njgin/edata/geocoding/index.html#!/) maintained by the NJ Geographic Information Network. This blog post will introduce a new side project of mine, `{njgeo}`, which provides an R client to New Jersey's publicly available geocoding API to improve the workflow of analyzing spatial data specific to the state of New Jersey.

### New Jersey's official geocoding service

The New Jersey Office of GIS (NJOGIS) runs several public [ArcGIS REST API endpoints](https://newjersey.maps.arcgis.com/home/item.html?id=dba4fc758a8f425f8fa83b8634b1b95c) via NJGIN that can be queryed by the public via the NJGIN. Many large businesses and governments rely on ESRI's software for their GIS needs, which has led to its REST API interface becoming a de facto standard in GIS, not like Microsoft Word in the word processing space.

The state's official geocoding service ("NJ_Geocode") can geocode addresses in New Jersey, converting  addresses into latitude and longitudes within a coordinate reference system used for mapping. The API is a convenient, free alternative to many commercial platforms that charge for geocoding by the API request (some maintained by ESRI).

One other advantage this geocoding service has is that it also takes into account some of NJOGIS's New Jersey-specific datasets, such as the road centerlines and enhanced source address points data that they integrated.

### The problem

But the problem in this case is that the ArcGIS APIs were only designed to work directly with ESRI's software, or through manually generated user requests via their spartan web interface. There have been other third party and official clients for ArcGIS written for R, however none have been targeted specifically to work with New Jersey's specific implmentation of the REST APIs.

ArcGIS may work for some people, but I prefer to work on GIS-related analysis in a scripting / command line environment, and being able to make requests to the ArcGIS APIs in a language like R or Python is better aligned with my preferred workflow in data science. So I decided to make this package mainly to automate some aspects of my workflow in analyzing New Jersey-specific data in R. If you happen to work with either of those things, this package may be for you.

### The njgeo R package

`{njgeo}` is a new package for R that I recently created. This package can be used to query the state's geocoding API without having to use ArcGIS on the desktop or use up any limited enterprise credits for geocoding. The package processes the JSON data received from the API and formulates the queries needed to perform geocoding, address candidate matchign & reverse geocoding, fully within R and without needing to rely on the use of external GIS software.

The package can be downloaded from [CRAN](https://cran.r-project.org/web/packages/njgeo/index.html) by running `install.packages('njgeo')`.



You can input a single string to geocode an address using `{njgeo}`

```{r, message=FALSE, warning=FALSE, cache=TRUE}
geocode_address_candidates("33 Livingston Ave. New Brunswick, NJ")
```

The package also allows you to specify a different coordinate reference system using the package's functions. Here we are changing from the default of EPSG:4326 to a projected one, EPSG:3424.

```{r, message=FALSE, warning=FALSE, cache=TRUE}
geocode_address_candidates("33 Livingston Ave. New Brunswick, NJ", crs = 3424)
```


### Batch geocoding

It is possible to batch geocode up to 1000 addresses at once using the two batch geocoding functions provided by the package.

The `batch_geocode_addresses()` and `batch_geocode_sl()` functions can batch geocode up to 1000 addresses at a time. The first function expects multiple columns of data to geocode the address, while the **sl** version requires an address in single column format.

### Reverse geocoding

Provide a point to get matching addresses:
```{r}
reverse_geocode(-74.44513, 40.49297)
```

## Shape and boundary files

You can easily obtain spatial boundary data for use in projects via this package. All objects are returned as an `{sf}` object and a coordinate reference system can be specified via arguments to repoject the shape into a different CRS. I mainly wanted to save the time of always repeating the same API queries in some of my New Jersey-specific projects.

### State

```{r}
get_state_bounds()
```

### Counties

```{r}
get_county_bounds() %>% 
  head()
```

### Municipalities

```{r}
get_muni_bounds() %>% 
  head()
```


