---
title: "A spatial analysis of New Jersey's medical cannabis dispensary accesibility"
author: "Gavin C. Rozzi"
date: "2022-04-17"
output:
  md_document:
    preserve_yaml: TRUE
    df_print: kable
    fig_retina: 3
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r message=FALSE, include=FALSE}
library(tidyverse)
library(sf)
library(tidycensus)
library(njgeo)
library(osrm)

data <- st_read('https://data.nj.gov/resource/p3ry-ipie.geojson')

count_by_county <- data %>%
  group_by(county) %>%
  count() %>%
  arrange(desc(n)) %>%
  st_drop_geometry()

nj_counties <- get_county_bounds() %>%
  st_drop_geometry() %>%
  select(COUNTY) %>%
  mutate(n = 0) %>%
  filter(COUNTY %in% count_by_county$county == FALSE) %>%
  rename("county" = COUNTY)

dispensary_count <- rbind(count_by_county,nj_counties) %>%
  arrange(n) %>%
  mutate(county = factor(county, levels = county,ordered = TRUE))
```

## One third of NJ counties lack even a single dispensary

Between a lack of permits available from the state Department of Health (now handled by the Cannabis Regulatory Commission), a [patchwork of local zoning and planning decisions](https://www.app.com/story/news/local/new-jersey/marijuana/2022/04/14/nj-weed-legalization-toms-river-consider-medical-pot-businesses/7289527001/) that often serve as obstacle, and [litigation over the previous round](https://www.njcourts.gov/attorneys/assets/opinions/appellate/published/a2204-18a2219-18a2276-18a2278-18a2283-18a2288-18a2292-18a2305-18.pdf?c=fHo) of dispensary permits, efforts to expand dispensaries have moved slowly.

The end result has been an unequal allocation of dispensaries across New Jersey —  with some counties missing out entirely. That has left residents to look to neighboring counties to obtain medical cannabis.

A third of all counties — Morris, Sussex, Somerset, Salem, Ocean, Hunterdon & Cape May — have not had a single medical cannabis dispensary commence operations since the state's medical cannabis began under Governor Chris Christie, [according to official state records.](https://data.nj.gov/Reference-Data/New-Jersey-Cannabis-Dispensary-List/p3ry-ipie)

```{r echo=FALSE}
ggplot(dispensary_count) +
  aes(x = county, fill = n, weight = n) +
  geom_bar() +
  scale_fill_viridis_c(option = "plasma", direction = 1) +
  labs(
    x = "County",
    y = "Dispensary Count",
    title = "Count of Medical Cannabis Dispensaries by New Jersey County",
    caption = "Data: NJOIT Open Data Center. Analysis and Visualization by Gavin Rozzi,
    @gavroz",
    fill = "Number of Dispensaries"
  ) +
  coord_flip() +
  theme_minimal()
```

## Mapping who is left behind by existing dispensaries

For those who reside in a county without a dispensary, travel times can be quite onerous. I'm particularly interested in looking at regions of New Jersey that are more than half an hour's drive to the nearest dispensary to illuminate regions of the state that might be best served by new dispensaries.

Using a tool called [Open Source Routing Machine (OSRM)](http://project-osrm.org) via R, I created isochrones — polygons that show drive times to a location at various geographic distances — for all currently licensed cannabis dispensaries in New Jersey. Inner segments of each polygon have shorter drive times, while outer segments represent a max drive time of half an hour (30 minutes). Those who reside in towns outside of this polygon can face max drive times of 30 minutes to over an hour to reach the nearest dispensary.


```{r cache=TRUE, include=FALSE}
if (file.exists('isochrones.geojson') == FALSE) {
isochrones <- data.frame()
for (i in 1:nrow(data)) {
  bks <- seq(from = 0, to = 60, by = 10)
  this_iso <- osrmIsochrone(loc = data[i,], returnclass="sf", breaks = bks)
  this_iso$dispensary_id <- i
  isochrones <- rbind(isochrones,this_iso)
}
st_write(isochrones,'isochrones.geojson', delete_dsn = TRUE)
}

if (file.exists('isochrones.geojson') == TRUE) {
  isochrones <- st_read('isochrones.geojson',quiet = TRUE)
}
```



```{r message=FALSE, warning=FALSE, include=FALSE}
sf::sf_use_s2(FALSE)
nj_census <- get_acs(geography = "county subdivision", 
                     variables = "B01001_001",
                     state = "NJ",
                     geometry = TRUE) %>%
  st_transform(4326) %>% filter(estimate > 0)

within_30_mins <- isochrones %>% 
  filter(max <= 30) %>%
  st_union() %>%
  st_sf()

sf::sf_use_s2(TRUE)

munis_greater_than30 <- st_filter(y = within_30_mins, x = nj_census, .predicate = st_disjoint)


#ggplot(tracts_greater_than30, aes(fill = estimate)) +
#  geom_sf() +
#  scale_fill_viridis_c(option = "plasma")

#ggplot(isochrones,aes(fill = max)) +
#  geom_sf() +
#  scale_fill_viridis_c(option = "plasma")

```

### Over 756,000 New Jerseyans face long drives to the nearest dispensary

The left side of the map shows a combined region of the state that can reach the nearest dispensary within 30 minutes, while the right side shows the individual isochrones, colored at 10 minute intervals. Individual dispensaries are mapped as pink points.

Municipalities are mapped and colored by population, and were included in this map if 100% of their boundaries were placed them at a maximum drive time of 30 minutes or greater to reach the nearest dispensary.

110 municipalities which are home to `r prettyNum(sum(munis_greater_than30$estimate),big.mark = ",")` New Jerseyans face maximum drive times of 30 minutes or greater to the nearest dispensary, a problem that is compounded by a lack of public transit infrastructure in some regions of the state.

## Concluding thoughts

Many medical cannabis patients are rightfully concerned that adult-use recreational sales will place further strain on an already inadequate system, with just 23 dispensaries serving a state of over 9 million residents. [Just 13 of them](https://www.app.com/story/news/local/new-jersey/marijuana/2022/04/11/nj-marijuana-legalization-medical-dispensaries-sales-approved/9533448002/) are set to start offering recreational sales when they begin on April 21st.

Much of Ocean County in the state's coastal region, and the northwest portion of the state in Sussex, Warren, Hunterdon & Morris counties are located outside of a reasonable distance to the nearest medical cannabis dispensary. Portions of Salem and Cape May counties would also benefit from a more optimally placed dispensary to better serve these municipalities.

New Jersey's cannabis regulators should adopt a data-driven planning strategy to strategically target under-served regions of the state to ensure a more equitable allocation of future dispensaries to the regions of New Jersey currently lacking them.

## The full list of towns

All 110 municipalities highlighted in this post with their current population from the 2020 ACS can be found below.

```{r echo=FALSE, message=FALSE, warning=FALSE}
munis_greater_than30 %>% st_drop_geometry() %>% as.data.frame() %>% select(NAME,estimate) %>%
  rename("Population Estimate" = estimate,
         "Town" = NAME)
```

